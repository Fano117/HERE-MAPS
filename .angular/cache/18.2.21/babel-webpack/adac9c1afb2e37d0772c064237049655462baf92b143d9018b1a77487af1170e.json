{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Alfredo/Documents/HERE-MAPS/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport let HereMapsService = /*#__PURE__*/(() => {\n  class HereMapsService {\n    constructor() {\n      this.API_KEY = 'GYo3JTyTU2DjUu_dGyaDc2LIZyANv1zL5-Lot729yhw';\n      this.initialized = false;\n      this.currentLocationSubject = new BehaviorSubject(null);\n      this.currentLocation$ = this.currentLocationSubject.asObservable();\n      this.ensureInitialized();\n    }\n    ensureInitialized() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.initialized) return;\n        yield _this.waitForHereMaps();\n        _this.initializePlatform();\n        _this.initialized = true;\n      })();\n    }\n    waitForHereMaps() {\n      return new Promise(resolve => {\n        const checkHereAPI = () => {\n          return typeof H !== 'undefined' && H.service && H.service.Platform && H.Map && H.mapevents && H.mapevents.Behavior && H.ui && H.ui.UI && H.map && H.map.Marker;\n        };\n        if (checkHereAPI()) {\n          resolve();\n          return;\n        }\n        const checkInterval = setInterval(() => {\n          if (checkHereAPI()) {\n            clearInterval(checkInterval);\n            resolve();\n          }\n        }, 100);\n        setTimeout(() => {\n          clearInterval(checkInterval);\n          resolve();\n        }, 10000);\n      });\n    }\n    initializePlatform() {\n      this.platform = new H.service.Platform({\n        'apikey': this.API_KEY\n      });\n      this.geocoder = this.platform.getSearchService();\n    }\n    geocodeAddress(query) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        yield _this2.ensureInitialized();\n        return new Promise((resolve, reject) => {\n          _this2.geocoder.geocode({\n            q: query\n          }, result => {\n            const addresses = result.items.map(item => ({\n              id: item.id,\n              label: item.address?.label || item.title,\n              houseNumber: item.address?.houseNumber,\n              street: item.address?.street,\n              district: item.address?.district,\n              city: item.address?.city,\n              postalCode: item.address?.postalCode,\n              countryName: item.address?.countryName,\n              coordinates: {\n                lat: item.position.lat,\n                lng: item.position.lng\n              }\n            }));\n            resolve(addresses);\n          }, error => {\n            reject(error);\n          });\n        });\n      })();\n    }\n    reverseGeocode(lat, lng) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        yield _this3.ensureInitialized();\n        return new Promise((resolve, reject) => {\n          _this3.geocoder.reverseGeocode({\n            at: `${lat},${lng}`\n          }, result => {\n            if (result.items && result.items.length > 0) {\n              const item = result.items[0];\n              const address = {\n                id: item.id,\n                label: item.address?.label || item.title,\n                houseNumber: item.address?.houseNumber,\n                street: item.address?.street,\n                district: item.address?.district,\n                city: item.address?.city,\n                postalCode: item.address?.postalCode,\n                countryName: item.address?.countryName,\n                coordinates: {\n                  lat: item.position.lat,\n                  lng: item.position.lng\n                }\n              };\n              resolve(address);\n            } else {\n              reject(new Error('No address found'));\n            }\n          }, error => {\n            reject(error);\n          });\n        });\n      })();\n    }\n    validateAddress(address) {\n      var _this4 = this;\n      return new Promise(/*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (resolve) {\n          try {\n            const results = yield _this4.geocodeAddress(address);\n            if (results.length > 0) {\n              const topResult = results[0];\n              const isExactMatch = _this4.isExactAddressMatch(address, topResult.label);\n              resolve({\n                isValid: isExactMatch,\n                suggestions: results\n              });\n            } else {\n              resolve({\n                isValid: false,\n                suggestions: []\n              });\n            }\n          } catch (error) {\n            resolve({\n              isValid: false,\n              suggestions: []\n            });\n          }\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n    isExactAddressMatch(input, result) {\n      const normalizeString = str => {\n        return str.toLowerCase().replace(/[,\\.]/g, ' ').replace(/\\s+/g, ' ').trim();\n      };\n      const normalizedInput = normalizeString(input);\n      const normalizedResult = normalizeString(result);\n      return normalizedResult.includes(normalizedInput) || normalizedInput.includes(normalizedResult);\n    }\n    createMap(_x2, _x3) {\n      var _this5 = this;\n      return _asyncToGenerator(function* (container, center, zoom = 15) {\n        try {\n          yield _this5.ensureInitialized();\n          if (!_this5.platform) {\n            throw new Error('Platform no inicializada');\n          }\n          const defaultLayers = _this5.platform.createDefaultLayers();\n          if (!defaultLayers || !defaultLayers.vector || !defaultLayers.vector.normal || !defaultLayers.vector.normal.map) {\n            throw new Error('Capas por defecto no disponibles');\n          }\n          const map = new H.Map(container, defaultLayers.vector.normal.map, {\n            zoom: zoom,\n            center: {\n              lat: center.lat,\n              lng: center.lng\n            }\n          });\n          const behavior = new H.mapevents.Behavior();\n          const ui = new H.ui.UI.createDefault(map);\n          return {\n            map,\n            ui,\n            behavior\n          };\n        } catch (error) {\n          throw new Error(`Error al crear el mapa: ${error}`);\n        }\n      }).apply(this, arguments);\n    }\n    addMarker(map, coordinates, options) {\n      const marker = new H.map.Marker(coordinates, options);\n      map.addObject(marker);\n      return marker;\n    }\n    updateLocation(locationUpdate) {\n      this.currentLocationSubject.next(locationUpdate);\n    }\n    getCurrentLocation() {\n      return this.currentLocationSubject.value;\n    }\n    static {\n      this.ɵfac = function HereMapsService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || HereMapsService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: HereMapsService,\n        factory: HereMapsService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return HereMapsService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}